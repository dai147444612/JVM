可达性算法要通过标记的方法实现，而标记阶段会停顿所有用户线程，这个停顿会随着堆的增大而增大。因此我们引入了三色标记作为辅助工具来辅助推到，但是这种方式在并发的情况下会出现“对象消失“的现象。



<img src="https://github.com/dai147444612/JVM/blob/main/image/%E6%88%AA%E5%B1%8F2021-08-01%20%E4%B8%8A%E5%8D%8810.44.16.png">
                                          上图为三色标记的实现过程


但是如果用户线程并发修改引用，会产生如下两种情况
<img src="https://github.com/dai147444612/JVM/blob/main/image/%E6%88%AA%E5%B1%8F2021-08-01%20%E4%B8%8A%E5%8D%8810.44.24.png">


图一由于黑色对象的引用时扫描后建立的但是灰色对象的引用又被切断了，所以黑色对象引用的白色对象将被清理，出现对象消失的情况。
图二同理。
1994年理论上证明了满足两种情况会产生对象消失：
·赋值器插入了一条或多条从黑色对象到白色对象的新引用；
·赋值器删除了全部从灰色对象到该白色对象的直接或间接引用。
两种解决方案：增量更新（Incremental Update）和原始快照（Snapshot At The Beginning， SATB）。
增量更新要破坏的是第一个条件，黑色对象一旦新插入了指向白色对象的引用之后，它就变回灰色对象 了。
原始快照要破坏的是第二个条件，灰色对象要删除指向白色对象的引用关系时，就将这个要删 除的引用记录下来，在并发扫描结束之后，再将这些记录过的引用关系中的灰色对象为根，重新扫描 一次。










